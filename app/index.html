<!doctype html>
    <head>
        <meta charset="utf-8">
        <title>touchanimation</title>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="styles/main.css">
        <script src="scripts/web-animations.js"></script>
        <script src="scripts/utils.js"></script>
    </head>
    <body style="height: 100%; overflow: hidden; ">

        <div class="sample" style="display: none">
            <h1>HTML Ipsum Presents</h1>

            <p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>

            <h2>Header Level 2</h2>

            <ol>
                <li>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</li>
                <li>Aliquam tincidunt mauris eu risus.</li>
            </ol>

            <blockquote><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus magna. Cras in mi at felis aliquet congue. Ut a est eget ligula molestie gravida. Curabitur massa. Donec eleifend, libero at sagittis mollis, tellus est malesuada tellus, at luctus turpis elit sit amet quam. Vivamus pretium ornare est.</p></blockquote>

            <h3>Header Level 3</h3>

            <ul>
                <li>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</li>
                <li>Aliquam tincidunt mauris eu risus.</li>
            </ul>
        </div>

        <div class="anim"></div>

        <script>
            var elem = document.querySelector('.anim');
            fillRows(elem, 2);
            // var height = utils.getHeight(document.body);
            var anim = new Animation(elem, [
                { offset: 0, transform: 'translateZ(0) translateY(0)' },
                { offset: 1, transform: 'translateZ(0) translateY(-1000px)' }
            ], {
                duration: 1
            });
            var player = document.timeline.play(anim);
            // player.paused = true;
            player.playbackRate = 0;


            elem.addEventListener('touchmove', stop);
            elem.addEventListener('touchstart', stop);
            elem.addEventListener('touchend', stop);

            var lastTouch, lastTouchTime, current = 0;
            elem.addEventListener('touchstart', function(event) {
                lastTouch = event.pageY || event.changedTouches[0].pageY;
                lastTouchTime = Date.now();
            });
            elem.addEventListener('touchmove', limit(12, touchMoveListener));



            function touchMoveListener(event) {
              var y = event.pageY || event.changedTouches[0].pageY,
                  moved = (y - lastTouch),
                  movedTime = Date.now() - lastTouchTime;
              lastTouch = y;
              lastTouchTime = Date.now();

              current += moved;
              player.currentTime = -current / 1000;
              // player.playbackRate = -(moved) / (movedTime/1000);
              // console.log(player.playbackRate);
            }



            function limit(minDelay, fn) {
                var lastCall = 0;
                return function() {
                    var now = Date.now();
                    if (now-lastCall < minDelay) {
                        return;
                    }
                    lastCall = now;
                    fn.apply(this, arguments);
                }
            }

            function stop(event) {
                event.preventDefault();
            }

            function fillRows(elem, count) {
                var i = 0, html = [], source = document.querySelector('.sample').innerHTML;
                for (i=0; i<count; i++) {
                    html.push(source);
                }
                elem.innerHTML = html.join('');
            }
        </script>

</body>
</html>
